<html>
<head>
<title>Developer notes about Report Manager</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
</head>

<body>
<h2>Developer</h2>
<h3>Devoloper notes about Report Manager</h3>
<h4>New github repository and nuget pagckages</p>
<p>Since version 3.9.15 nuget packages of Reportman are availble also 
  a new <a href="https://github.com/tonimartir/reportman">repository</a> for .net development have been created</p>
<h4>BiDi Support, complex languajes</p>
<p>Bidi complex languages support is implemented sinc 3.9.15 version using DirectWrite in Windows and ICU-Harfbuzz
  in Linux. Since version 3.9.15</p>
<h4>BiDi Support, complex languajes</p>
<p>Bidi complex languages support is implemented sinc 3.9.15 version using DirectWrite in Windows and ICU-Harfbuzz
  in Linux. Since version 3.9.15</p>

<h4>TClientDataset and BCD types, why Delphi 5 enterprise version at least need</h4>
<p>TRpDataset (rpdataset.pas) is a TClientDataset to buffer all the datasets passed 
  to the engine that can feature grouping, so the main dataset go forward only 
  (support for unidirectional datasets like SQLExpress), but the engine can remember 
  at least two records to do grouping.</p>
<p>The method to implement TRpDataset is duplicate fields of new Dataset to a 
  newly created TClientDataset (rpdataset)<br>
</p>
<p>Then assign fields and post the record in memory...</p>
<p>for i:=0 to fieldcount-1 do<br>
  fields[i].Assign(fielddefs[i]);</p>
<p>It's a bit more complex because needs freeing memory (garbage old records)</p>
<p>This worked fine inclusive passing opened datasets to the engine until I updated 
  to Delphi 7, where blob fields assignements are broken, I added the function 
  AssignField(Source,Destination), and a compiler define, active for Delphi 7 
  (BLOBSTREAMBUG) so assignement for blobfields are patched in this function.</p>
<p>If you find an assignment fails using a particular type (like BCD) you can 
  patch the assignment there, send me the bugfix so I will add a compiler define 
  for the bug and add to the main tree.</p>
<p>BCD is a problematic type, see for example FormatVariant function in rptypes.pas.</p>
<h4>Borland changes in TFiler in Delphi 6 and up</h4>
<p>Borland have changed the way it stores WideStrings because Utf8 support.<br>
  (TFiler,TWriter,TReader) since Delphi 6, so because the engine can be compiled 
  with any version of Delphi/Builder/Kylix, WideStrings properties are written 
  in a custom way, really they are written in the Delphi 4/5 way.<br>
  WideString properties are TRpLabel text, Font names, etc.</p>
<p>From classes.pas</p>
<p>procedure TWriter.WriteWideString(const Value: WideString);<br>
  var<br>
  L: Integer;<br>
  Utf8Str: UTF8String;<br>
  begin<br>
  Utf8Str := Utf8Encode(Value);<br>
  if Length(Utf8Str) &lt; (Length(Value) * SizeOf(WideChar)) then<br>
  WriteMinStr(Value, Utf8Str)<br>
  else<br>
  begin<br>
  WriteValue(vaWString);<br>
  L := Length(Value);<br>
  Write(L, SizeOf(Integer));<br>
  Write(Pointer(Value)^, L * 2);<br>
  end;<br>
  end;</p>
<p>This causes a incompatibility with earlier versions of Delphi.</p>
<p>The workaround is a to store all the widestring properties as <br>
  special properties defined in DefineProperties of each report <br>
  streamable component, and write and read the widestrings using the <br>
  old Delphi 5 method.</p>
<p>This problem was fixed in 1.2 version.</p>
<h4>The horrible bug in Delphi 7 about TComboBox (VCL) empty items</h4>
<p>Delphi 7 has a horrible bug, when you place a TCombobox in a form, with a empty 
  selectable item (csDropDownList), at run time, selecting this item the application 
  will crash (Win9x), or raise an exception in ntdll (WinNT) or work correctly 
  (WinXP).</p>
<p>A patch for this issue is expected in a service pack, but for now all the empty 
  selectable items of comboboxes are replaced with a a space (' ') to solve this 
  issue. For your convenience the engine also includes a patch unit (D7GetComboBoxStringsPatch.pas) 
  for your projects</p>
<p><b>The Open/Save dialog Windows CLX bug since Delphi 7</b></p>
<p>Delphi 7 has another horrible bug in CLX Open/Save Dialogs, a 'Drive C: not 
  found' exception is raised if you try to select a file that is not in the root 
  dir, but only in Win9x systems, in WinNT/XP works ok. Because for windows a 
  pure VCL version is provided (repmandxp.exe) I don't worry about this issue 
  but if you find a workaround feel free to send me it. You can reproduce it compiling 
  repmand.exe for Windows and saving files in Windows 9x OS.</p>


</body>
</html>
